if (self.CavalryLogger) { CavalryLogger.start_js(["ZAsBr"]); }

__d("isFacebookishURI",["isFacebookURI","isMessengerDotComURI"],(function(a,b,c,d,e,f){"use strict";e.exports=a;function a(a){return b("isFacebookURI")(a)||b("isMessengerDotComURI")(a)}}),null);
__d("ZenonPlatformExperiments",["ScotchRTWebUserActionLogger","gkx","qex"],(function(a,b,c,d,e,f){"use strict";f.getOpusPtimeMungeValue=a;f.isMwpp=c;f.isOpusMungeEnabled=d;f.shouldUseLobbyMode=e;f.shouldUseStateSync=g;f.shouldEnableMWSAudioNack=h;function a(){var a;return(a=b("qex")._("1426590"))!=null?a:60}function c(){var a;return(a=b("qex")._("1566745"))!=null?a:!1}function d(){var a;return(a=b("qex")._("1426589"))!=null?a:!0}function e(){var a;a=(a=b("gkx")("1450329"))!=null?a:!1;a&&b("ScotchRTWebUserActionLogger").logCheckpointOnceForDomain({checkpoint:"gk: rtc_www_lobby_mode"});return a}function g(){var a=b("gkx")("1418215");a&&b("ScotchRTWebUserActionLogger").logCheckpointOnceForDomain({checkpoint:"gk: rtc_www_state_sync"});return a}function h(){var a;return(a=b("qex")._("1713531"))!=null?a:!1}}),null);
__d("ZenonOfferStorage",["CacheStorage"],(function(a,b,c,d,e,f){"use strict";f._storeData=k;f.getStorage=l;f.writePeerOfferToStorage=a;var g="localstorage",h="RTC_",i="offer",j="offer_msg";function k(a,b,c){c={__d:c,__t:Date.now()};a.set(b,c)}function l(a,c){return new(b("CacheStorage"))(g,""+h+a+"_"+c+"_")}function a(a,b){a=l(a,j);k(a,i,b)}}),null);
__d("ZenonP2PMessageDedup",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(){this.$1={}}var b=a.prototype;b.isDuplicate=function(a){var b=a.call_id,c=a.from;a=a.id;this.$1[c]||(this.$1[c]={});this.$1[c][b]||(this.$1[c][b]={});if(this.$1[c][b][a])return!0;this.$1[c][b][a]=!0;return!1};return a}();e.exports=a}),null);
__d("ZenonSignalingTransportTypes",[],(function(a,b,c,d,e,f){"use strict";a=Object.freeze({CHILD_WINDOW_READY:"rtc_child_window_ready",PARENT_INITIATED_CALL:"rtc_child_window_start_call",PARENT_TO_CHILD_MESSAGE:"rtc_child_window_message"});f.ChildTransportMessageType=a}),null);
__d("ZenonSignalingParentTransport",["FBLogger","FBRTCSupport","Random","URI","ZenonOfferStorage","ZenonP2PMessageDedup","ZenonP2PMessageTypes","ZenonPlatformExperiments","ZenonSignalingTransportTypes","isFacebookishURI","recoverableViolation"],(function(a,b,c,d,e,f){"use strict";var g,h=10*60*1e3,i=45*1e3;a=function(){function a(){var a=this;this.verificationNonce=null;this.portToChild=null;this.$1=null;this.$2=null;this.$3=new Map();this.$4=new Map();this.$5=new(b("ZenonP2PMessageDedup"))();this.$6=new Map();b("FBRTCSupport").isWebrtcSupported()&&window.addEventListener&&window.addEventListener("message",function(b){a.handleWindowMessageFromChild(b)},!1)}var c=a.prototype;c.handleWindowMessageFromChild=function(a){var c=this;if(this.windowMessageValid(a)&&a.data.type===b("ZenonSignalingTransportTypes").ChildTransportMessageType.CHILD_WINDOW_READY&&this.hasPort(a)){var d;d=(d=a.data.roomID)!=null?d:null;this.portToChild=a.ports[0];a=a.data;var e=a.childNonce;a=a.peerID;this.$2=e;window.clearTimeout(this.$1);this.$1=window.setTimeout(function(){c.portToChild=null},i);this.verificationNonce=this.generateNonce();this.startCallInChildWindow(d);this.$7(a)}};c.generateNonce=function(){return String(b("Random").random())};c.hasPort=function(a){return Boolean(a.ports!=null&&Array.isArray(a.ports)&&a.ports[0]!=null)};c.startCallInChildWindow=function(a){var c=null;if(b("ZenonPlatformExperiments").isMwpp()&&a!=null){c=(a=this.$3.get(a))!=null?a:null}a={mwRingRequest:c,nonce:this.$2,offer:null,type:b("ZenonSignalingTransportTypes").ChildTransportMessageType.PARENT_INITIATED_CALL};this.sendMessageToChild(a)};c.windowMessageValid=function(a){return Boolean(a.origin===window.location.origin||b("isFacebookishURI")(new(g||(g=b("URI")))(a.origin))&&b("isFacebookishURI")(new(g||(g=b("URI")))(window.location.origin)))&&this.postMessageValid(a)};c.postMessageValid=function(a){return Boolean(this.verificationNonce!==null&&(a==null?void 0:(a=a.data)==null?void 0:a.nonce)===this.verificationNonce)};c.$7=function(a){var b;b=(b=this.$4.get(a))!=null?b:[];var c=Date.now();b=b.map(function(a){return a.time<=c-h?null:a.value}).filter(Boolean);for(var b=b,d=Array.isArray(b),e=0,b=d?b:b[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f;if(d){if(e>=b.length)break;f=b[e++]}else{e=b.next();if(e.done)break;f=e.value}f=f;this.sendSignalingMessageToChild(f)}this.$4["delete"](a)};c.sendSignalingMessageToChild=function(a){a={message:a,nonce:this.$2,type:b("ZenonSignalingTransportTypes").ChildTransportMessageType.PARENT_TO_CHILD_MESSAGE};this.sendMessageToChild(a)};c.sendMessageToChild=function(a){this.portToChild!=null?this.portToChild.postMessage(a):b("recoverableViolation")("The child window port should be available","rtc_www")};c.enqueueRawMWMessage=function(a){var b=a.jsonPayload,c=b.body;b=b.header;c=c.ringRequest;if(c){c=b.conferenceName;this.$3.set(c,a)}};c.enqueueRawP2PMessage=function(a){if(this.$5.isDuplicate(a))return;var c=String(a.from);if(a.msg_type===b("ZenonP2PMessageTypes").ZenonP2PSignalingPayloadType.OFFER){this.$8(a);return}this.portToChild!=null&&this.sendSignalingMessageToChild(a);var d=this.$4.get(c);d||(d=[],this.$4.set(c,d));d.push({time:Date.now(),value:a})};c.testGetChildNonce=function(){return this.$2};c.storeOfferForBackwardsCompat=function(a,c){var d=this.$9(a,c);if(d===null){b("FBLogger")("rtc_www").mustfix("P2P callee child window opening with no offer in storage.",a,c);return}b("ZenonOfferStorage").writePeerOfferToStorage(a,d)};c.$9=function(a,b){a=a+","+b;return(b=this.$6.get(a))!=null?b:null};c.$8=function(a){var b=a.call_id,c=String(a.from);c=c+","+b;this.$6.set(c,a)};return a}();e.exports=a}),null);